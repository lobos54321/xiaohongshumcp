<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦å…¨è‡ªåŠ¨è¿è¥ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .auto-running {
            background: linear-gradient(90deg, #10b981, #059669, #10b981);
            background-size: 200% 100%;
            animation: flow 3s ease-in-out infinite;
        }
        @keyframes flow { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">

        <!-- Header -->
        <div class="text-center text-white mb-8">
            <h1 class="text-4xl font-bold mb-2">ğŸ¤– å°çº¢ä¹¦å…¨è‡ªåŠ¨è¿è¥ç³»ç»Ÿ</h1>
            <p class="text-lg opacity-90">ä¸€æ¬¡è®¾ç½®ï¼Œç»ˆèº«è‡ªåŠ¨ - è®©Claudeä¸ºä½ æ‰“ç†ä¸€åˆ‡</p>
        </div>

        <!-- Setup Wizard -->
        <div id="setupWizard" class="space-y-6">

            <!-- Step 1: Login -->
            <div id="step1" class="card rounded-2xl p-8 shadow-xl">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold mr-4">1</div>
                    <h2 class="text-2xl font-bold">ğŸ“± æ‰«ç ç™»å½•å°çº¢ä¹¦</h2>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">ç”¨æˆ·æ˜µç§°</label>
                                <input type="text" id="userNickname" placeholder="ç»™è‡ªå·±èµ·ä¸ªåå­—"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <button onclick="getLoginQR()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition">
                                è·å–ç™»å½•äºŒç»´ç 
                            </button>
                            <div id="loginStatus" class="text-center text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <div class="flex items-center justify-center">
                        <div id="qrCodeArea" class="w-48 h-48 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400">
                            äºŒç»´ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Product Info -->
            <div id="step2" class="card rounded-2xl p-8 shadow-xl opacity-50">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 bg-gray-400 text-white rounded-full flex items-center justify-center font-bold mr-4">2</div>
                    <h2 class="text-2xl font-bold">ğŸ¯ è®¾ç½®äº§å“å’Œç›®æ ‡</h2>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">äº§å“/æœåŠ¡</label>
                            <input type="text" id="productName" placeholder="ä¾‹å¦‚ï¼šæ‰‹å·¥å’–å•¡åº—"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">ç›®æ ‡å®¢æˆ·</label>
                            <input type="text" id="targetAudience" placeholder="ä¾‹å¦‚ï¼š25-35å²éƒ½å¸‚ç™½é¢†"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">è¥é”€ç›®æ ‡</label>
                            <select id="marketingGoal" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="brand">å“ç‰ŒçŸ¥ååº¦</option>
                                <option value="sales">é”€å”®è½¬åŒ–</option>
                                <option value="engagement">ç²‰ä¸äº’åŠ¨</option>
                                <option value="traffic">åº—é“ºå¼•æµ</option>
                            </select>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">å‘å¸ƒé¢‘ç‡</label>
                            <select id="postFrequency" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="daily">æ¯å¤©1ç¯‡</option>
                                <option value="twice-daily">æ¯å¤©2ç¯‡</option>
                                <option value="high-freq">æ¯å¤©3-5ç¯‡</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">å“ç‰Œé£æ ¼</label>
                            <select id="brandStyle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="warm">æ¸©æš–æ²»æ„ˆ</option>
                                <option value="professional">ä¸“ä¸šæƒå¨</option>
                                <option value="trendy">æ—¶å°šæ½®æµ</option>
                                <option value="funny">å¹½é»˜é£è¶£</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">å®¡æ ¸æ¨¡å¼</label>
                            <select id="reviewMode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="auto">å®Œå…¨è‡ªåŠ¨</option>
                                <option value="review">å‘å¸ƒå‰å®¡æ ¸</option>
                                <option value="edit">å…è®¸ç¼–è¾‘</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button onclick="saveConfiguration()" class="w-full mt-6 bg-purple-500 hover:bg-purple-600 text-white font-medium py-3 px-6 rounded-lg transition" disabled>
                    ä¿å­˜é…ç½®å¹¶å¯åŠ¨è‡ªåŠ¨è¿è¥
                </button>
            </div>
        </div>

        <!-- Auto Manager Dashboard -->
        <div id="autoManagerDashboard" class="hidden space-y-6">

            <!-- Status Header -->
            <div class="card rounded-2xl p-6 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ¤– è‡ªåŠ¨è¿è¥ä¸­</h2>
                        <p class="text-gray-600" id="autoStatusText">Claudeæ­£åœ¨ä¸ºæ‚¨çš„å’–å•¡åº—è§„åˆ’å†…å®¹...</p>
                    </div>
                    <div class="text-right">
                        <div class="auto-running text-white px-4 py-2 rounded-lg font-medium">
                            <span class="pulse">â—</span> è¿è¡Œä¸­
                        </div>
                        <div class="text-sm text-gray-500 mt-1" id="runningTime">å·²è¿è¡Œ 2å°æ—¶15åˆ†</div>
                    </div>
                </div>
            </div>

            <!-- AI Planning Panel -->
            <div class="grid md:grid-cols-3 gap-6">

                <!-- Content Strategy -->
                <div class="card rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        ğŸ§  å†…å®¹ç­–ç•¥
                    </h3>
                    <div id="aiStrategy" class="space-y-3 text-sm">
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="font-medium text-blue-800">æœ¬å‘¨ä¸»é¢˜</div>
                            <div class="text-blue-600">ç§‹å­£æ–°å“æ¨å¹¿</div>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg">
                            <div class="font-medium text-green-800">çƒ­é—¨è¯é¢˜</div>
                            <div class="text-green-600">#ç§‹æ—¥æš–é¥® #æ‰‹å†²å’–å•¡</div>
                        </div>
                        <div class="bg-purple-50 p-3 rounded-lg">
                            <div class="font-medium text-purple-800">å‘å¸ƒæ—¶æœº</div>
                            <div class="text-purple-600">9:00, 15:00, 20:00</div>
                        </div>
                    </div>
                </div>

                <!-- Today's Plan -->
                <div class="card rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        ğŸ“… ä»Šæ—¥è®¡åˆ’
                    </h3>
                    <div id="todayPlan" class="space-y-3 text-sm">
                        <div class="flex items-center justify-between p-2 bg-green-50 rounded-lg">
                            <span>æ—©é¤æ­é…æ¨è</span>
                            <span class="text-green-600 text-xs">âœ“ å·²å‘å¸ƒ</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-yellow-50 rounded-lg">
                            <span>æ–°å“æ‹‰èŠ±æ•™å­¦</span>
                            <span class="text-yellow-600 text-xs">â± 15:00</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                            <span>æ™šé—´æ°›å›´åˆ†äº«</span>
                            <span class="text-gray-600 text-xs">â³ 20:00</span>
                        </div>
                    </div>
                </div>

                <!-- Performance -->
                <div class="card rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        ğŸ“Š è¿è¥æ•°æ®
                    </h3>
                    <div id="performance" class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span>ä»Šæ—¥å‘å¸ƒ</span>
                            <span class="font-medium text-blue-600">1 / 3</span>
                        </div>
                        <div class="flex justify-between">
                            <span>æœ¬å‘¨é˜…è¯»</span>
                            <span class="font-medium text-green-600">2.3k</span>
                        </div>
                        <div class="flex justify-between">
                            <span>æ–°å¢ç²‰ä¸</span>
                            <span class="font-medium text-purple-600">+24</span>
                        </div>
                        <div class="flex justify-between">
                            <span>äº’åŠ¨ç‡</span>
                            <span class="font-medium text-orange-600">8.5%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Activity Feed -->
            <div class="card rounded-xl p-6 shadow-lg">
                <h3 class="text-lg font-bold mb-4">ğŸ”´ å®æ—¶æ´»åŠ¨</h3>
                <div id="activityFeed" class="space-y-3 max-h-64 overflow-y-auto">
                    <!-- Activities will be populated here -->
                </div>
            </div>

            <!-- Control Panel -->
            <div class="card rounded-xl p-6 shadow-lg">
                <h3 class="text-lg font-bold mb-4">âš™ï¸ æ§åˆ¶é¢æ¿</h3>
                <div class="grid md:grid-cols-4 gap-4">
                    <button onclick="pauseAutoMode()" class="bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-lg transition">
                        â¸ï¸ æš‚åœ
                    </button>
                    <button onclick="showPendingPosts()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition">
                        ğŸ“ å¾…å‘å†…å®¹
                    </button>
                    <button onclick="adjustStrategy()" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg transition">
                        ğŸ¯ è°ƒæ•´ç­–ç•¥
                    </button>
                    <button onclick="viewAnalytics()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition">
                        ğŸ“ˆ æ•°æ®åˆ†æ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è‡ªåŠ¨æ£€æµ‹APIåœ°å€
        const CLAUDE_API = window.location.hostname === 'localhost'
            ? 'http://localhost:4000'
            : window.location.origin;

        let currentUser = null;
        let autoModeEnabled = false;

        // è·å–ç™»å½•äºŒç»´ç 
        async function getLoginQR() {
            const nickname = document.getElementById('userNickname').value;
            if (!nickname) {
                alert('è¯·è¾“å…¥ç”¨æˆ·æ˜µç§°');
                return;
            }

            currentUser = `user_${Date.now()}`;

            try {
                const response = await fetch(`${CLAUDE_API}/agent/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUser,
                        prompt: 'è¯·å¸®æˆ‘è·å–å°çº¢ä¹¦ç™»å½•äºŒç»´ç '
                    })
                });

                const data = await response.json();
                if (data.success) {
                    // æ˜¾ç¤ºäºŒç»´ç ï¼ˆè¿™é‡Œéœ€è¦æ ¹æ®å®é™…è¿”å›çš„æ•°æ®æ ¼å¼è°ƒæ•´ï¼‰
                    document.getElementById('qrCodeArea').innerHTML =
                        `<div class="text-center">
                            <div class="w-32 h-32 bg-gray-100 mx-auto mb-2 flex items-center justify-center">
                                QR Code
                            </div>
                            <div class="text-sm text-gray-600">è¯·ç”¨å°çº¢ä¹¦æ‰«ç ç™»å½•</div>
                        </div>`;

                    document.getElementById('loginStatus').innerHTML =
                        '<span class="text-blue-600">è¯·ç”¨å°çº¢ä¹¦APPæ‰«æäºŒç»´ç ç™»å½•</span>';

                    // å¯ç”¨ç¬¬äºŒæ­¥
                    enableStep2();

                    // å¼€å§‹æ£€æŸ¥ç™»å½•çŠ¶æ€
                    checkLoginStatus();
                }
            } catch (error) {
                console.error('è·å–äºŒç»´ç å¤±è´¥:', error);
                document.getElementById('loginStatus').innerHTML =
                    '<span class="text-red-600">è·å–äºŒç»´ç å¤±è´¥ï¼Œè¯·é‡è¯•</span>';
            }
        }

        // å¯ç”¨ç¬¬äºŒæ­¥
        function enableStep2() {
            const step2 = document.getElementById('step2');
            step2.classList.remove('opacity-50');
            step2.querySelector('.bg-gray-400').classList.remove('bg-gray-400');
            step2.querySelector('.bg-gray-400').classList.add('bg-purple-500');
            step2.querySelector('button').disabled = false;
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        async function checkLoginStatus() {
            const checkInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${CLAUDE_API}/agent/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: currentUser,
                            prompt: 'æ£€æŸ¥å°çº¢ä¹¦ç™»å½•çŠ¶æ€'
                        })
                    });

                    const data = await response.json();
                    if (data.success && data.data.content.includes('å·²ç™»å½•')) {
                        clearInterval(checkInterval);
                        document.getElementById('loginStatus').innerHTML =
                            '<span class="text-green-600">âœ“ ç™»å½•æˆåŠŸï¼</span>';

                        // è‡ªåŠ¨æ»šåŠ¨åˆ°ç¬¬äºŒæ­¥
                        document.getElementById('step2').scrollIntoView({ behavior: 'smooth' });
                    }
                } catch (error) {
                    console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
                }
            }, 3000); // æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡

            // 30ç§’ååœæ­¢æ£€æŸ¥
            setTimeout(() => clearInterval(checkInterval), 30000);
        }

        // ä¿å­˜é…ç½®å¹¶å¯åŠ¨è‡ªåŠ¨è¿è¥
        async function saveConfiguration() {
            const config = {
                userId: currentUser,
                productName: document.getElementById('productName').value,
                targetAudience: document.getElementById('targetAudience').value,
                marketingGoal: document.getElementById('marketingGoal').value,
                postFrequency: document.getElementById('postFrequency').value,
                brandStyle: document.getElementById('brandStyle').value,
                reviewMode: document.getElementById('reviewMode').value
            };

            if (!config.productName) {
                alert('è¯·å¡«å†™äº§å“/æœåŠ¡ä¿¡æ¯');
                return;
            }

            try {
                // å‘é€é…ç½®ç»™Claudeï¼Œè®©å®ƒå¼€å§‹åˆ¶å®šè¿è¥ç­–ç•¥
                const response = await fetch(`${CLAUDE_API}/agent/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUser,
                        prompt: `è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ä¸ºæˆ‘åˆ¶å®šå°çº¢ä¹¦è‡ªåŠ¨è¿è¥ç­–ç•¥ï¼š
                        äº§å“ï¼š${config.productName}
                        ç›®æ ‡å®¢æˆ·ï¼š${config.targetAudience}
                        è¥é”€ç›®æ ‡ï¼š${config.marketingGoal}
                        å‘å¸ƒé¢‘ç‡ï¼š${config.postFrequency}
                        å“ç‰Œé£æ ¼ï¼š${config.brandStyle}
                        å®¡æ ¸æ¨¡å¼ï¼š${config.reviewMode}

                        è¯·ä¸ºæˆ‘åˆ¶å®šè¯¦ç»†çš„å†…å®¹è§„åˆ’ï¼Œå¹¶å¼€å§‹è‡ªåŠ¨è¿è¥ã€‚`
                    })
                });

                const data = await response.json();
                if (data.success) {
                    // åˆ‡æ¢åˆ°è‡ªåŠ¨è¿è¥ç•Œé¢
                    document.getElementById('setupWizard').classList.add('hidden');
                    document.getElementById('autoManagerDashboard').classList.remove('hidden');

                    autoModeEnabled = true;
                    startAutoMode(config);
                }
            } catch (error) {
                console.error('å¯åŠ¨è‡ªåŠ¨è¿è¥å¤±è´¥:', error);
                alert('å¯åŠ¨å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // å¯åŠ¨è‡ªåŠ¨æ¨¡å¼
        function startAutoMode(config) {
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            document.getElementById('autoStatusText').textContent =
                `Claudeæ­£åœ¨ä¸ºæ‚¨çš„${config.productName}åˆ¶å®šè¿è¥ç­–ç•¥...`;

            // å¼€å§‹è¿è¥è®¡æ—¶
            let startTime = Date.now();
            setInterval(() => {
                const elapsed = Date.now() - startTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                document.getElementById('runningTime').textContent =
                    `å·²è¿è¡Œ ${hours}å°æ—¶${minutes}åˆ†`;
            }, 60000);

            // æ¨¡æ‹Ÿæ´»åŠ¨æµ
            simulateActivity();

            // å®šæœŸæ£€æŸ¥å’Œæ‰§è¡Œä»»åŠ¡
            setInterval(executeScheduledTasks, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        }

        // æ¨¡æ‹Ÿå®æ—¶æ´»åŠ¨
        function simulateActivity() {
            const activities = [
                'ğŸ¤– Claudeæ­£åœ¨åˆ†æçƒ­é—¨è¯é¢˜...',
                'ğŸ“ æ­£åœ¨ç”Ÿæˆæ–°çš„å†…å®¹åˆ›æ„...',
                'ğŸ¨ æ­£åœ¨åˆ¶ä½œé…å›¾...',
                'ğŸ“Š æ­£åœ¨åˆ†ææœ€ä½³å‘å¸ƒæ—¶é—´...',
                'ğŸ” æ­£åœ¨ç ”ç©¶ç«å“å†…å®¹...',
                'ğŸ’¡ å‘ç°æ–°çš„è¥é”€æœºä¼š...',
                'ğŸ“ˆ æ­£åœ¨ä¼˜åŒ–å†…å®¹ç­–ç•¥...'
            ];

            setInterval(() => {
                if (autoModeEnabled) {
                    const activity = activities[Math.floor(Math.random() * activities.length)];
                    addActivityLog(activity);
                }
            }, 5000);
        }

        // æ·»åŠ æ´»åŠ¨æ—¥å¿—
        function addActivityLog(message) {
            const feed = document.getElementById('activityFeed');
            const time = new Date().toLocaleTimeString();

            const activityDiv = document.createElement('div');
            activityDiv.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
            activityDiv.innerHTML = `
                <span class="text-sm">${message}</span>
                <span class="text-xs text-gray-500">${time}</span>
            `;

            feed.insertBefore(activityDiv, feed.firstChild);

            // åªä¿ç•™æœ€æ–°çš„10æ¡è®°å½•
            while (feed.children.length > 10) {
                feed.removeChild(feed.lastChild);
            }
        }

        // æ‰§è¡Œå®šæ—¶ä»»åŠ¡
        async function executeScheduledTasks() {
            if (!autoModeEnabled) return;

            // è¿™é‡Œä¼šè°ƒç”¨Claudeæ¥æ‰§è¡Œå…·ä½“çš„ä»»åŠ¡
            // æ¯”å¦‚ç”Ÿæˆå†…å®¹ã€å‘å¸ƒæ–‡ç« ã€åˆ†ææ•°æ®ç­‰
            console.log('æ‰§è¡Œå®šæ—¶ä»»åŠ¡...');
        }

        // æ§åˆ¶é¢æ¿åŠŸèƒ½
        function pauseAutoMode() {
            autoModeEnabled = false;
            alert('è‡ªåŠ¨è¿è¥å·²æš‚åœ');
        }

        function showPendingPosts() {
            alert('åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function adjustStrategy() {
            alert('åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function viewAnalytics() {
            alert('åŠŸèƒ½å¼€å‘ä¸­...');
        }
    </script>
</body>
</html>