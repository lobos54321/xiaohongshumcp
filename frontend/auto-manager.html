<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小红书全自动运营系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .auto-running {
            background: linear-gradient(90deg, #10b981, #059669, #10b981);
            background-size: 200% 100%;
            animation: flow 3s ease-in-out infinite;
        }
        @keyframes flow { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">

        <!-- Header -->
        <div class="text-center text-white mb-8">
            <h1 class="text-4xl font-bold mb-2">🤖 小红书全自动运营系统</h1>
            <p class="text-lg opacity-90">一次设置，终身自动 - 让Claude为你打理一切</p>
        </div>

        <!-- Setup Wizard -->
        <div id="setupWizard" class="space-y-6">

            <!-- Step 1: Login -->
            <div id="step1" class="card rounded-2xl p-8 shadow-xl">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold mr-4">1</div>
                    <h2 class="text-2xl font-bold">📱 扫码登录小红书</h2>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">用户昵称</label>
                                <input type="text" id="userNickname" placeholder="给自己起个名字"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <button onclick="getLoginQR()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition">
                                获取登录二维码
                            </button>
                            <div id="loginStatus" class="text-center text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <div class="flex items-center justify-center">
                        <div id="qrCodeArea" class="w-48 h-48 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400">
                            二维码将在这里显示
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Product Info -->
            <div id="step2" class="card rounded-2xl p-8 shadow-xl opacity-50">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 bg-gray-400 text-white rounded-full flex items-center justify-center font-bold mr-4">2</div>
                    <h2 class="text-2xl font-bold">🎯 设置产品和目标</h2>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">产品/服务</label>
                            <input type="text" id="productName" placeholder="例如：手工咖啡店"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">目标客户</label>
                            <input type="text" id="targetAudience" placeholder="例如：25-35岁都市白领"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">营销目标</label>
                            <select id="marketingGoal" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="brand">品牌知名度</option>
                                <option value="sales">销售转化</option>
                                <option value="engagement">粉丝互动</option>
                                <option value="traffic">店铺引流</option>
                            </select>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">发布频率</label>
                            <select id="postFrequency" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="daily">每天1篇</option>
                                <option value="twice-daily">每天2篇</option>
                                <option value="high-freq">每天3-5篇</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">品牌风格</label>
                            <select id="brandStyle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="warm">温暖治愈</option>
                                <option value="professional">专业权威</option>
                                <option value="trendy">时尚潮流</option>
                                <option value="funny">幽默风趣</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">审核模式</label>
                            <select id="reviewMode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="auto">完全自动</option>
                                <option value="review">发布前审核</option>
                                <option value="edit">允许编辑</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button onclick="saveConfiguration()" class="w-full mt-6 bg-purple-500 hover:bg-purple-600 text-white font-medium py-3 px-6 rounded-lg transition" disabled>
                    保存配置并启动自动运营
                </button>
            </div>
        </div>

        <!-- Auto Manager Dashboard -->
        <div id="autoManagerDashboard" class="hidden space-y-6">

            <!-- Status Header -->
            <div class="card rounded-2xl p-6 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">🤖 自动运营中</h2>
                        <p class="text-gray-600" id="autoStatusText">Claude正在为您的咖啡店规划内容...</p>
                    </div>
                    <div class="text-right">
                        <div class="auto-running text-white px-4 py-2 rounded-lg font-medium">
                            <span class="pulse">●</span> 运行中
                        </div>
                        <div class="text-sm text-gray-500 mt-1" id="runningTime">已运行 2小时15分</div>
                    </div>
                </div>
            </div>

            <!-- AI Planning Panel -->
            <div class="grid md:grid-cols-3 gap-6">

                <!-- Content Strategy -->
                <div class="card rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        🧠 内容策略
                    </h3>
                    <div id="aiStrategy" class="space-y-3 text-sm">
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="font-medium text-blue-800">本周主题</div>
                            <div class="text-blue-600">秋季新品推广</div>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg">
                            <div class="font-medium text-green-800">热门话题</div>
                            <div class="text-green-600">#秋日暖饮 #手冲咖啡</div>
                        </div>
                        <div class="bg-purple-50 p-3 rounded-lg">
                            <div class="font-medium text-purple-800">发布时机</div>
                            <div class="text-purple-600">9:00, 15:00, 20:00</div>
                        </div>
                    </div>
                </div>

                <!-- Today's Plan -->
                <div class="card rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        📅 今日计划
                    </h3>
                    <div id="todayPlan" class="space-y-3 text-sm">
                        <div class="flex items-center justify-between p-2 bg-green-50 rounded-lg">
                            <span>早餐搭配推荐</span>
                            <span class="text-green-600 text-xs">✓ 已发布</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-yellow-50 rounded-lg">
                            <span>新品拉花教学</span>
                            <span class="text-yellow-600 text-xs">⏱ 15:00</span>
                        </div>
                        <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                            <span>晚间氛围分享</span>
                            <span class="text-gray-600 text-xs">⏳ 20:00</span>
                        </div>
                    </div>
                </div>

                <!-- Performance -->
                <div class="card rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        📊 运营数据
                    </h3>
                    <div id="performance" class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span>今日发布</span>
                            <span class="font-medium text-blue-600">1 / 3</span>
                        </div>
                        <div class="flex justify-between">
                            <span>本周阅读</span>
                            <span class="font-medium text-green-600">2.3k</span>
                        </div>
                        <div class="flex justify-between">
                            <span>新增粉丝</span>
                            <span class="font-medium text-purple-600">+24</span>
                        </div>
                        <div class="flex justify-between">
                            <span>互动率</span>
                            <span class="font-medium text-orange-600">8.5%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Activity Feed -->
            <div class="card rounded-xl p-6 shadow-lg">
                <h3 class="text-lg font-bold mb-4">🔴 实时活动</h3>
                <div id="activityFeed" class="space-y-3 max-h-64 overflow-y-auto">
                    <!-- Activities will be populated here -->
                </div>
            </div>

            <!-- Control Panel -->
            <div class="card rounded-xl p-6 shadow-lg">
                <h3 class="text-lg font-bold mb-4">⚙️ 控制面板</h3>
                <div class="grid md:grid-cols-4 gap-4">
                    <button onclick="pauseAutoMode()" class="bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-lg transition">
                        ⏸️ 暂停
                    </button>
                    <button onclick="showPendingPosts()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition">
                        📝 待发内容
                    </button>
                    <button onclick="adjustStrategy()" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg transition">
                        🎯 调整策略
                    </button>
                    <button onclick="viewAnalytics()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition">
                        📈 数据分析
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 自动检测API地址
        const CLAUDE_API = window.location.hostname === 'localhost'
            ? 'http://localhost:4000'
            : window.location.origin;

        let currentUser = null;
        let autoModeEnabled = false;

        // 获取登录二维码
        async function getLoginQR() {
            const nickname = document.getElementById('userNickname').value;
            if (!nickname) {
                alert('请输入用户昵称');
                return;
            }

            currentUser = `user_${Date.now()}`;

            try {
                const response = await fetch(`${CLAUDE_API}/agent/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUser,
                        prompt: '请帮我获取小红书登录二维码'
                    })
                });

                const data = await response.json();
                if (data.success) {
                    // 显示二维码（这里需要根据实际返回的数据格式调整）
                    document.getElementById('qrCodeArea').innerHTML =
                        `<div class="text-center">
                            <div class="w-32 h-32 bg-gray-100 mx-auto mb-2 flex items-center justify-center">
                                QR Code
                            </div>
                            <div class="text-sm text-gray-600">请用小红书扫码登录</div>
                        </div>`;

                    document.getElementById('loginStatus').innerHTML =
                        '<span class="text-blue-600">请用小红书APP扫描二维码登录</span>';

                    // 启用第二步
                    enableStep2();

                    // 开始检查登录状态
                    checkLoginStatus();
                }
            } catch (error) {
                console.error('获取二维码失败:', error);
                document.getElementById('loginStatus').innerHTML =
                    '<span class="text-red-600">获取二维码失败，请重试</span>';
            }
        }

        // 启用第二步
        function enableStep2() {
            const step2 = document.getElementById('step2');
            step2.classList.remove('opacity-50');
            step2.querySelector('.bg-gray-400').classList.remove('bg-gray-400');
            step2.querySelector('.bg-gray-400').classList.add('bg-purple-500');
            step2.querySelector('button').disabled = false;
        }

        // 检查登录状态
        async function checkLoginStatus() {
            const checkInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${CLAUDE_API}/agent/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: currentUser,
                            prompt: '检查小红书登录状态'
                        })
                    });

                    const data = await response.json();
                    if (data.success && data.data.content.includes('已登录')) {
                        clearInterval(checkInterval);
                        document.getElementById('loginStatus').innerHTML =
                            '<span class="text-green-600">✓ 登录成功！</span>';

                        // 自动滚动到第二步
                        document.getElementById('step2').scrollIntoView({ behavior: 'smooth' });
                    }
                } catch (error) {
                    console.error('检查登录状态失败:', error);
                }
            }, 3000); // 每3秒检查一次

            // 30秒后停止检查
            setTimeout(() => clearInterval(checkInterval), 30000);
        }

        // 保存配置并启动自动运营
        async function saveConfiguration() {
            const config = {
                userId: currentUser,
                productName: document.getElementById('productName').value,
                targetAudience: document.getElementById('targetAudience').value,
                marketingGoal: document.getElementById('marketingGoal').value,
                postFrequency: document.getElementById('postFrequency').value,
                brandStyle: document.getElementById('brandStyle').value,
                reviewMode: document.getElementById('reviewMode').value
            };

            if (!config.productName) {
                alert('请填写产品/服务信息');
                return;
            }

            try {
                // 发送配置给Claude，让它开始制定运营策略
                const response = await fetch(`${CLAUDE_API}/agent/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUser,
                        prompt: `请根据以下信息为我制定小红书自动运营策略：
                        产品：${config.productName}
                        目标客户：${config.targetAudience}
                        营销目标：${config.marketingGoal}
                        发布频率：${config.postFrequency}
                        品牌风格：${config.brandStyle}
                        审核模式：${config.reviewMode}

                        请为我制定详细的内容规划，并开始自动运营。`
                    })
                });

                const data = await response.json();
                if (data.success) {
                    // 切换到自动运营界面
                    document.getElementById('setupWizard').classList.add('hidden');
                    document.getElementById('autoManagerDashboard').classList.remove('hidden');

                    autoModeEnabled = true;
                    startAutoMode(config);
                }
            } catch (error) {
                console.error('启动自动运营失败:', error);
                alert('启动失败，请重试');
            }
        }

        // 启动自动模式
        function startAutoMode(config) {
            // 更新状态文本
            document.getElementById('autoStatusText').textContent =
                `Claude正在为您的${config.productName}制定运营策略...`;

            // 开始运营计时
            let startTime = Date.now();
            setInterval(() => {
                const elapsed = Date.now() - startTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                document.getElementById('runningTime').textContent =
                    `已运行 ${hours}小时${minutes}分`;
            }, 60000);

            // 模拟活动流
            simulateActivity();

            // 定期检查和执行任务
            setInterval(executeScheduledTasks, 60000); // 每分钟检查一次
        }

        // 模拟实时活动
        function simulateActivity() {
            const activities = [
                '🤖 Claude正在分析热门话题...',
                '📝 正在生成新的内容创意...',
                '🎨 正在制作配图...',
                '📊 正在分析最佳发布时间...',
                '🔍 正在研究竞品内容...',
                '💡 发现新的营销机会...',
                '📈 正在优化内容策略...'
            ];

            setInterval(() => {
                if (autoModeEnabled) {
                    const activity = activities[Math.floor(Math.random() * activities.length)];
                    addActivityLog(activity);
                }
            }, 5000);
        }

        // 添加活动日志
        function addActivityLog(message) {
            const feed = document.getElementById('activityFeed');
            const time = new Date().toLocaleTimeString();

            const activityDiv = document.createElement('div');
            activityDiv.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
            activityDiv.innerHTML = `
                <span class="text-sm">${message}</span>
                <span class="text-xs text-gray-500">${time}</span>
            `;

            feed.insertBefore(activityDiv, feed.firstChild);

            // 只保留最新的10条记录
            while (feed.children.length > 10) {
                feed.removeChild(feed.lastChild);
            }
        }

        // 执行定时任务
        async function executeScheduledTasks() {
            if (!autoModeEnabled) return;

            // 这里会调用Claude来执行具体的任务
            // 比如生成内容、发布文章、分析数据等
            console.log('执行定时任务...');
        }

        // 控制面板功能
        function pauseAutoMode() {
            autoModeEnabled = false;
            alert('自动运营已暂停');
        }

        function showPendingPosts() {
            alert('功能开发中...');
        }

        function adjustStrategy() {
            alert('功能开发中...');
        }

        function viewAnalytics() {
            alert('功能开发中...');
        }
    </script>
</body>
</html>