<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çº¢ä¹¦å…¨è‡ªåŠ¨è¿è¥ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .auto-running {
            background: linear-gradient(90deg, #10b981, #059669, #10b981);
            background-size: 200% 100%;
            animation: flow 3s ease-in-out infinite;
        }
        @keyframes flow { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        .chat-message { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">

        <!-- Header -->
        <div class="text-center text-white mb-8">
            <h1 class="text-4xl font-bold mb-2">ğŸ¤– å°çº¢ä¹¦å…¨è‡ªåŠ¨è¿è¥ç³»ç»Ÿ</h1>
            <p class="text-lg opacity-90">ä¸€æ¬¡è®¾ç½®ï¼Œç»ˆèº«è‡ªåŠ¨ - è®©Claudeä¸ºä½ æ‰“ç†ä¸€åˆ‡</p>
        </div>

        <!-- Setup Wizard -->
        <div id="setupWizard" class="space-y-6">

            <!-- Step 1: Login -->
            <div id="step1" class="card rounded-2xl p-8 shadow-xl">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold mr-4">1</div>
                    <h2 class="text-2xl font-bold">ğŸ“± æ‰«ç ç™»å½•å°çº¢ä¹¦</h2>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <div class="space-y-4">
                            <div class="text-center">
                                <div class="text-lg font-medium mb-2">æ‰«ç ç™»å½•å°çº¢ä¹¦</div>
                                <div class="text-gray-600 text-sm">ç™»å½•åå³å¯å¼€å§‹è‡ªåŠ¨è¿è¥</div>
                            </div>
                            <button onclick="getLoginQR()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition">
                                è·å–ç™»å½•äºŒç»´ç 
                            </button>
                            <div id="loginStatus" class="text-center text-sm text-gray-600"></div>
                        </div>
                    </div>
                    <div class="flex items-center justify-center">
                        <div id="qrCodeArea" class="w-48 h-48 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400">
                            äºŒç»´ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Product Info -->
            <div id="step2" class="card rounded-2xl p-8 shadow-xl opacity-50">
                <div class="flex items-center mb-6">
                    <div class="w-8 h-8 bg-gray-400 text-white rounded-full flex items-center justify-center font-bold mr-4">2</div>
                    <h2 class="text-2xl font-bold">ğŸ¯ è®¾ç½®äº§å“å’Œç›®æ ‡</h2>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">äº§å“/æœåŠ¡</label>
                            <input type="text" id="productName" placeholder="ä¾‹å¦‚ï¼šæ‰‹å·¥å’–å•¡åº—"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">ç›®æ ‡å®¢æˆ·</label>
                            <input type="text" id="targetAudience" placeholder="ä¾‹å¦‚ï¼š25-35å²éƒ½å¸‚ç™½é¢†"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">è¥é”€ç›®æ ‡</label>
                            <select id="marketingGoal" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="brand">å“ç‰ŒçŸ¥ååº¦</option>
                                <option value="sales">é”€å”®è½¬åŒ–</option>
                                <option value="engagement">ç²‰ä¸äº’åŠ¨</option>
                                <option value="traffic">åº—é“ºå¼•æµ</option>
                            </select>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">å‘å¸ƒé¢‘ç‡</label>
                            <select id="postFrequency" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="daily">æ¯å¤©1ç¯‡</option>
                                <option value="twice-daily">æ¯å¤©2ç¯‡</option>
                                <option value="high-freq">æ¯å¤©3-5ç¯‡</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">å“ç‰Œé£æ ¼</label>
                            <select id="brandStyle" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="warm">æ¸©æš–æ²»æ„ˆ</option>
                                <option value="professional">ä¸“ä¸šæƒå¨</option>
                                <option value="trendy">æ—¶å°šæ½®æµ</option>
                                <option value="funny">å¹½é»˜é£è¶£</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">å®¡æ ¸æ¨¡å¼</label>
                            <select id="reviewMode" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="auto">å®Œå…¨è‡ªåŠ¨</option>
                                <option value="review">å‘å¸ƒå‰å®¡æ ¸</option>
                                <option value="edit">å…è®¸ç¼–è¾‘</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button onclick="saveConfiguration()" class="w-full mt-6 bg-purple-500 hover:bg-purple-600 text-white font-medium py-3 px-6 rounded-lg transition" disabled>
                    ä¿å­˜é…ç½®å¹¶å¯åŠ¨è‡ªåŠ¨è¿è¥
                </button>
            </div>
        </div>

        <!-- Auto Manager Dashboard -->
        <div id="autoManagerDashboard" class="hidden space-y-6">

            <!-- Status Header -->
            <div class="card rounded-2xl p-6 shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">ğŸ¤– è‡ªåŠ¨è¿è¥ä¸­</h2>
                        <p class="text-gray-600" id="autoStatusText">Claudeæ­£åœ¨ä¸ºæ‚¨çš„äº§å“è§„åˆ’å†…å®¹...</p>
                    </div>
                    <div class="text-right">
                        <div class="auto-running text-white px-4 py-2 rounded-lg font-medium">
                            <span class="pulse">â—</span> è¿è¡Œä¸­
                        </div>
                        <div class="text-sm text-gray-500 mt-1" id="runningTime">å·²è¿è¡Œ 0åˆ†é’Ÿ</div>
                    </div>
                </div>
            </div>

            <!-- AI Planning Panel -->
            <div class="grid md:grid-cols-3 gap-6">

                <!-- Content Strategy -->
                <div class="card rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        ğŸ§  å†…å®¹ç­–ç•¥
                    </h3>
                    <div id="aiStrategy" class="space-y-3 text-sm">
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="font-medium text-blue-800">æœ¬å‘¨ä¸»é¢˜</div>
                            <div class="text-blue-600">æ­£åœ¨åˆ†æ...</div>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg">
                            <div class="font-medium text-green-800">çƒ­é—¨è¯é¢˜</div>
                            <div class="text-green-600">æ­£åœ¨æ”¶é›†...</div>
                        </div>
                        <div class="bg-purple-50 p-3 rounded-lg">
                            <div class="font-medium text-purple-800">å‘å¸ƒæ—¶æœº</div>
                            <div class="text-purple-600">æ­£åœ¨ä¼˜åŒ–...</div>
                        </div>
                    </div>
                </div>

                <!-- Today's Plan -->
                <div class="card rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        ğŸ“… ä»Šæ—¥è®¡åˆ’
                    </h3>
                    <div id="todayPlan" class="space-y-3 text-sm">
                        <div class="text-gray-500 text-center py-4">
                            Claudeæ­£åœ¨åˆ¶å®šä»Šæ—¥è®¡åˆ’...
                        </div>
                    </div>
                </div>

                <!-- Performance -->
                <div class="card rounded-xl p-6 shadow-lg">
                    <h3 class="text-lg font-bold mb-4 flex items-center">
                        ğŸ“Š è¿è¥æ•°æ®
                    </h3>
                    <div id="performance" class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span>ä»Šæ—¥å‘å¸ƒ</span>
                            <span class="font-medium text-blue-600">0 / è®¡åˆ’ä¸­</span>
                        </div>
                        <div class="flex justify-between">
                            <span>æœ¬å‘¨é˜…è¯»</span>
                            <span class="font-medium text-green-600">æ”¶é›†ä¸­</span>
                        </div>
                        <div class="flex justify-between">
                            <span>æ–°å¢ç²‰ä¸</span>
                            <span class="font-medium text-purple-600">ç»Ÿè®¡ä¸­</span>
                        </div>
                        <div class="flex justify-between">
                            <span>äº’åŠ¨ç‡</span>
                            <span class="font-medium text-orange-600">åˆ†æä¸­</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Activity Feed -->
            <div class="card rounded-xl p-6 shadow-lg">
                <h3 class="text-lg font-bold mb-4">ğŸ”´ å®æ—¶æ´»åŠ¨</h3>
                <div id="activityFeed" class="space-y-3 max-h-64 overflow-y-auto">
                    <!-- Activities will be populated here -->
                </div>
            </div>

            <!-- Control Panel -->
            <div class="card rounded-xl p-6 shadow-lg">
                <h3 class="text-lg font-bold mb-4">âš™ï¸ æ§åˆ¶é¢æ¿</h3>
                <div class="grid md:grid-cols-4 gap-4">
                    <button onclick="pauseAutoMode()" class="bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-lg transition">
                        â¸ï¸ æš‚åœ
                    </button>
                    <button onclick="showPendingPosts()" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition">
                        ğŸ“ å¾…å‘å†…å®¹
                    </button>
                    <button onclick="adjustStrategy()" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg transition">
                        ğŸ¯ è°ƒæ•´ç­–ç•¥
                    </button>
                    <button onclick="viewAnalytics()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition">
                        ğŸ“ˆ æ•°æ®åˆ†æ
                    </button>
                </div>
            </div>

            <!-- Manual Chat Interface (Hidden by default) -->
            <div id="manualChatInterface" class="hidden card rounded-xl p-6 shadow-lg">
                <h3 class="text-lg font-bold mb-4">ğŸ’¬ æ‰‹åŠ¨å¯¹è¯</h3>
                <div id="chatMessages" class="h-64 overflow-y-auto space-y-3 mb-4 p-4 bg-gray-50 rounded-lg">
                    <!-- Chat messages will be populated here -->
                </div>
                <div class="flex gap-2">
                    <input type="text" id="chatInput" placeholder="è¾“å…¥æŒ‡ä»¤..."
                        class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                        onkeypress="if(event.key==='Enter') sendManualMessage()">
                    <button onclick="sendManualMessage()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg transition">
                        å‘é€
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è‡ªåŠ¨æ£€æµ‹APIåœ°å€
        const CLAUDE_API = window.location.hostname === 'localhost'
            ? 'http://localhost:4000'
            : window.location.origin;

        let currentUser = null;
        let autoModeEnabled = false;
        let startTime = null;

        // è·å–ç™»å½•äºŒç»´ç 
        async function getLoginQR() {
            currentUser = `user_${Date.now()}`;

            try {
                const response = await fetch(`${CLAUDE_API}/agent/xiaohongshu/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUser
                    })
                });

                const data = await response.json();
                if (data.success) {
                    // ç›´æ¥åµŒå…¥å°çº¢ä¹¦ç™»å½•é¡µé¢
                    document.getElementById('qrCodeArea').innerHTML =
                        `<div class="text-center">
                            <div class="mb-2">
                                <iframe
                                    src="https://www.xiaohongshu.com/login"
                                    width="300"
                                    height="400"
                                    frameborder="0"
                                    style="border: 2px solid #e5e7eb; border-radius: 12px; background: white;"
                                    sandbox="allow-same-origin allow-scripts allow-forms allow-popups">
                                </iframe>
                            </div>
                            <div class="text-sm text-gray-600">è¯·ç”¨æ‰‹æœºå°çº¢ä¹¦APPæ‰«æä¸Šæ–¹äºŒç»´ç </div>
                        </div>`;

                    document.getElementById('loginStatus').innerHTML =
                        `<div class="text-green-600">
                            <div>âœ… å°çº¢ä¹¦ç™»å½•é¡µé¢å·²åŠ è½½</div>
                            <div class="text-sm text-gray-500 mt-1">è¯·æ‰«æä¸Šæ–¹äºŒç»´ç å®Œæˆç™»å½•</div>
                        </div>`;

                    // å¯ç”¨ç¬¬äºŒæ­¥
                    enableStep2();

                    // æ£€æŸ¥ç™»å½•çŠ¶æ€ï¼ˆå®šæœŸæ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼‰
                    const checkInterval = setInterval(() => {
                        // è¿™é‡Œå¯ä»¥é€šè¿‡postMessageä¸iframeé€šä¿¡æ£€æŸ¥ç™»å½•çŠ¶æ€
                        // æˆ–è€…è®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»"å·²å®Œæˆç™»å½•"æŒ‰é’®
                        console.log('æ£€æŸ¥ç™»å½•çŠ¶æ€...');
                    }, 3000);

                    // æ·»åŠ "å·²å®Œæˆç™»å½•"æŒ‰é’®
                    setTimeout(() => {
                        document.getElementById('loginStatus').innerHTML +=
                            `<div class="mt-2">
                                <button onclick="confirmLogin()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 text-sm">
                                    æˆ‘å·²å®Œæˆæ‰«ç ç™»å½• âœ“
                                </button>
                            </div>`;
                    }, 2000);
                } else {
                    document.getElementById('loginStatus').innerHTML =
                        `<div class="text-red-600">å¯åŠ¨å¤±è´¥: ${data.error}</div>`;
                }
            } catch (error) {
                console.error('è·å–äºŒç»´ç å¤±è´¥:', error);
                document.getElementById('loginStatus').innerHTML =
                    '<span class="text-red-600">è·å–äºŒç»´ç å¤±è´¥ï¼Œè¯·é‡è¯•</span>';
            }
        }

        // å¯ç”¨ç¬¬äºŒæ­¥
        function enableStep2() {
            const step2 = document.getElementById('step2');
            step2.classList.remove('opacity-50');
            const numberDiv = step2.querySelector('.bg-gray-400');
            if (numberDiv) {
                numberDiv.classList.remove('bg-gray-400');
                numberDiv.classList.add('bg-purple-500');
            }
            step2.querySelector('button').disabled = false;
        }

        // ç¡®è®¤ç™»å½•å®Œæˆ
        function confirmLogin() {
            document.getElementById('loginStatus').innerHTML =
                `<div class="text-green-600">
                    <div>âœ… ç™»å½•ç¡®è®¤æˆåŠŸ</div>
                    <div class="text-sm text-gray-500 mt-1">å¯ä»¥ç»§ç»­é…ç½®äº§å“ä¿¡æ¯äº†</div>
                </div>`;

            // åˆ‡æ¢åˆ°è®¾ç½®ç¬¬äºŒæ­¥çš„é‡ç‚¹
            const step2Button = document.getElementById('step2').querySelector('button');
            step2Button.classList.add('ring-2', 'ring-purple-300', 'animate-pulse');
            step2Button.textContent = 'ç«‹å³é…ç½®äº§å“ â†’';
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        async function checkLoginStatus() {
            const checkInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${CLAUDE_API}/agent/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: currentUser,
                            prompt: 'æ£€æŸ¥å°çº¢ä¹¦ç™»å½•çŠ¶æ€'
                        })
                    });

                    const data = await response.json();
                    if (data.success && data.data.content.includes('å·²ç™»å½•')) {
                        clearInterval(checkInterval);
                        document.getElementById('loginStatus').innerHTML =
                            '<span class="text-green-600">âœ“ ç™»å½•æˆåŠŸï¼</span>';

                        // è‡ªåŠ¨æ»šåŠ¨åˆ°ç¬¬äºŒæ­¥
                        document.getElementById('step2').scrollIntoView({ behavior: 'smooth' });
                    }
                } catch (error) {
                    console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
                }
            }, 3000);

            // 30ç§’ååœæ­¢æ£€æŸ¥
            setTimeout(() => clearInterval(checkInterval), 30000);
        }

        // ä¿å­˜é…ç½®å¹¶å¯åŠ¨è‡ªåŠ¨è¿è¥
        async function saveConfiguration() {
            const config = {
                userId: currentUser,
                productName: document.getElementById('productName').value,
                targetAudience: document.getElementById('targetAudience').value,
                marketingGoal: document.getElementById('marketingGoal').value,
                postFrequency: document.getElementById('postFrequency').value,
                brandStyle: document.getElementById('brandStyle').value,
                reviewMode: document.getElementById('reviewMode').value
            };

            if (!config.productName) {
                alert('è¯·å¡«å†™äº§å“/æœåŠ¡ä¿¡æ¯');
                return;
            }

            try {
                // å‘é€é…ç½®ç»™Claudeï¼Œå¯åŠ¨è‡ªåŠ¨æ¨¡å¼
                const response = await fetch(`${CLAUDE_API}/agent/auto/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                const data = await response.json();
                if (data.success) {
                    // åˆ‡æ¢åˆ°è‡ªåŠ¨è¿è¥ç•Œé¢
                    document.getElementById('setupWizard').classList.add('hidden');
                    document.getElementById('autoManagerDashboard').classList.remove('hidden');

                    autoModeEnabled = true;
                    startTime = Date.now();
                    startAutoMode(config);
                } else {
                    alert('å¯åŠ¨å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                console.error('å¯åŠ¨è‡ªåŠ¨è¿è¥å¤±è´¥:', error);
                alert('å¯åŠ¨å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // å¯åŠ¨è‡ªåŠ¨æ¨¡å¼
        function startAutoMode(config) {
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬
            document.getElementById('autoStatusText').textContent =
                `Claudeæ­£åœ¨ä¸ºæ‚¨çš„${config.productName}åˆ¶å®šè¿è¥ç­–ç•¥...`;

            // å¼€å§‹è¿è¥è®¡æ—¶
            const updateTimer = () => {
                if (!startTime) return;
                const elapsed = Date.now() - startTime;
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                document.getElementById('runningTime').textContent =
                    `å·²è¿è¡Œ ${hours}å°æ—¶${minutes}åˆ†`;
            };
            setInterval(updateTimer, 60000);
            updateTimer();

            // å¼€å§‹è·å–AIç­–ç•¥å’Œè®¡åˆ’
            fetchAIStrategy();
            fetchTodayPlan();

            // æ¨¡æ‹Ÿæ´»åŠ¨æµ
            simulateActivity();

            // å®šæœŸæ›´æ–°æ•°æ®
            setInterval(updateDashboard, 30000);
        }

        // è·å–AIç­–ç•¥
        async function fetchAIStrategy() {
            try {
                const response = await fetch(`${CLAUDE_API}/agent/auto/strategy/${currentUser}`);
                const data = await response.json();

                if (data.success && data.strategy) {
                    updateStrategyDisplay(data.strategy);
                }
            } catch (error) {
                console.error('è·å–ç­–ç•¥å¤±è´¥:', error);
            }
        }

        // è·å–ä»Šæ—¥è®¡åˆ’
        async function fetchTodayPlan() {
            try {
                const response = await fetch(`${CLAUDE_API}/agent/auto/plan/${currentUser}`);
                const data = await response.json();

                if (data.success && data.plan) {
                    updatePlanDisplay(data.plan);
                }
            } catch (error) {
                console.error('è·å–è®¡åˆ’å¤±è´¥:', error);
            }
        }

        // æ›´æ–°ç­–ç•¥æ˜¾ç¤º
        function updateStrategyDisplay(strategy) {
            const container = document.getElementById('aiStrategy');
            container.innerHTML = `
                <div class="bg-blue-50 p-3 rounded-lg">
                    <div class="font-medium text-blue-800">æœ¬å‘¨ä¸»é¢˜</div>
                    <div class="text-blue-600">${strategy.keyThemes?.join(', ') || 'åˆ¶å®šä¸­...'}</div>
                </div>
                <div class="bg-green-50 p-3 rounded-lg">
                    <div class="font-medium text-green-800">çƒ­é—¨è¯é¢˜</div>
                    <div class="text-green-600">${strategy.trendingTopics?.join(', ') || 'åˆ†æä¸­...'}</div>
                </div>
                <div class="bg-purple-50 p-3 rounded-lg">
                    <div class="font-medium text-purple-800">å‘å¸ƒæ—¶æœº</div>
                    <div class="text-purple-600">${strategy.optimalTimes?.join(', ') || 'ä¼˜åŒ–ä¸­...'}</div>
                </div>
            `;
        }

        // æ›´æ–°è®¡åˆ’æ˜¾ç¤º
        function updatePlanDisplay(plan) {
            const container = document.getElementById('todayPlan');
            if (plan.tasks && plan.tasks.length > 0) {
                container.innerHTML = plan.tasks.map(task => `
                    <div class="flex items-center justify-between p-2 bg-${task.status === 'completed' ? 'green' : task.status === 'in-progress' ? 'yellow' : 'gray'}-50 rounded-lg">
                        <span>${task.title}</span>
                        <span class="text-${task.status === 'completed' ? 'green' : task.status === 'in-progress' ? 'yellow' : 'gray'}-600 text-xs">
                            ${task.status === 'completed' ? 'âœ“ å·²å®Œæˆ' : task.status === 'in-progress' ? 'â± è¿›è¡Œä¸­' : 'â³ è®¡åˆ’ä¸­'}
                        </span>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<div class="text-gray-500 text-center py-4">æš‚æ— è®¡åˆ’</div>';
            }
        }

        // æ¨¡æ‹Ÿå®æ—¶æ´»åŠ¨
        function simulateActivity() {
            const activities = [
                'ğŸ¤– Claudeæ­£åœ¨åˆ†æçƒ­é—¨è¯é¢˜...',
                'ğŸ“ æ­£åœ¨ç”Ÿæˆæ–°çš„å†…å®¹åˆ›æ„...',
                'ğŸ¨ æ­£åœ¨åˆ¶ä½œé…å›¾...',
                'ğŸ“Š æ­£åœ¨åˆ†ææœ€ä½³å‘å¸ƒæ—¶é—´...',
                'ğŸ” æ­£åœ¨ç ”ç©¶ç«å“å†…å®¹...',
                'ğŸ’¡ å‘ç°æ–°çš„è¥é”€æœºä¼š...',
                'ğŸ“ˆ æ­£åœ¨ä¼˜åŒ–å†…å®¹ç­–ç•¥...'
            ];

            setInterval(() => {
                if (autoModeEnabled) {
                    const activity = activities[Math.floor(Math.random() * activities.length)];
                    addActivityLog(activity);
                }
            }, 8000);
        }

        // æ·»åŠ æ´»åŠ¨æ—¥å¿—
        function addActivityLog(message) {
            const feed = document.getElementById('activityFeed');
            const time = new Date().toLocaleTimeString();

            const activityDiv = document.createElement('div');
            activityDiv.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
            activityDiv.innerHTML = `
                <span class="text-sm">${message}</span>
                <span class="text-xs text-gray-500">${time}</span>
            `;

            feed.insertBefore(activityDiv, feed.firstChild);

            // åªä¿ç•™æœ€æ–°çš„10æ¡è®°å½•
            while (feed.children.length > 10) {
                feed.removeChild(feed.lastChild);
            }
        }

        // æ›´æ–°ä»ªè¡¨ç›˜
        async function updateDashboard() {
            try {
                const response = await fetch(`${CLAUDE_API}/agent/auto/stats/${currentUser}`);
                const data = await response.json();

                if (data.success && data.stats) {
                    updatePerformanceDisplay(data.stats);
                }
            } catch (error) {
                console.error('æ›´æ–°æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ›´æ–°æ€§èƒ½æ˜¾ç¤º
        function updatePerformanceDisplay(stats) {
            const container = document.getElementById('performance');
            container.innerHTML = `
                <div class="flex justify-between">
                    <span>ä»Šæ—¥å‘å¸ƒ</span>
                    <span class="font-medium text-blue-600">${stats.todayPosts || 0} / ${stats.plannedPosts || 0}</span>
                </div>
                <div class="flex justify-between">
                    <span>æœ¬å‘¨é˜…è¯»</span>
                    <span class="font-medium text-green-600">${stats.weeklyReads || 'ç»Ÿè®¡ä¸­'}</span>
                </div>
                <div class="flex justify-between">
                    <span>æ–°å¢ç²‰ä¸</span>
                    <span class="font-medium text-purple-600">+${stats.newFollowers || 0}</span>
                </div>
                <div class="flex justify-between">
                    <span>äº’åŠ¨ç‡</span>
                    <span class="font-medium text-orange-600">${stats.engagementRate || 0}%</span>
                </div>
            `;
        }

        // æ§åˆ¶é¢æ¿åŠŸèƒ½
        function pauseAutoMode() {
            if (autoModeEnabled) {
                autoModeEnabled = false;
                alert('è‡ªåŠ¨è¿è¥å·²æš‚åœ');
                // è¿™é‡Œå¯ä»¥è°ƒç”¨APIæš‚åœæœåŠ¡
            } else {
                autoModeEnabled = true;
                startTime = Date.now();
                alert('è‡ªåŠ¨è¿è¥å·²æ¢å¤');
            }
        }

        function showPendingPosts() {
            // æ˜¾ç¤ºå¾…å®¡æ ¸å†…å®¹
            document.getElementById('manualChatInterface').classList.toggle('hidden');
        }

        function adjustStrategy() {
            alert('ç­–ç•¥è°ƒæ•´åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function viewAnalytics() {
            alert('æ•°æ®åˆ†æåŠŸèƒ½å¼€å‘ä¸­...');
        }

        // æ‰‹åŠ¨å¯¹è¯åŠŸèƒ½
        async function sendManualMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            input.value = '';
            addChatMessage('user', message);

            try {
                const response = await fetch(`${CLAUDE_API}/agent/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUser,
                        prompt: message
                    })
                });

                const data = await response.json();
                if (data.success) {
                    addChatMessage('assistant', data.data.content);
                } else {
                    addChatMessage('assistant', 'é”™è¯¯: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                addChatMessage('assistant', 'é”™è¯¯: ' + error.message);
            }
        }

        function addChatMessage(role, content) {
            const container = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message p-3 rounded-lg ${role === 'user' ? 'bg-purple-100 ml-8' : 'bg-gray-100 mr-8'}`;
            messageDiv.innerHTML = `
                <div class="font-medium text-sm mb-1">${role === 'user' ? 'ğŸ‘¤ ä½ ' : 'ğŸ¤– Claude'}</div>
                <div class="text-sm">${content}</div>
            `;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = () => {
            addActivityLog('ğŸš€ ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
        };
    </script>
</body>
</html>